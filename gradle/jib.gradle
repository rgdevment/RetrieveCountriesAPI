jib {
    from {
        image = 'eclipse-temurin:21-alpine'
    }
    to {
        image = "us-central1-docker.pkg.dev/${System.getenv('GCP_PROJECT')}/${System.getenv('ARTIFACTS_NAME')}/countries-api"
        auth {
            username = 'oauth2accesstoken'
            password = 'gcloud auth print-access-token'.execute().text.trim()
        }
        tags = ['latest', project.version.toString()]
    }
    container {
        def instanceMemory = System.getenv('INSTANCE_MEMORY') as double
        def minMemory = (0.7 * instanceMemory).round()
        def maxMemory = (0.8 * instanceMemory).round()
        jvmFlags = ["-Xms${minMemory}m", "-Xmx${maxMemory}m"]
        mainClass = 'cl.restapi.retrievecountriesapi.RetrieveCountriesApiApplication'
    }
}
